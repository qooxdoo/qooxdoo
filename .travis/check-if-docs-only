#!/usr/bin/env bash

set -e

git config remote.origin.fetch "+refs/heads/*:refs/remotes/origin/*"
git fetch > /dev/null
CHANGED_FILES=`git diff --name-only HEAD origin/master`
echo "Changed files: $CHANGED_FILES"
CONTAINS_DOCS=False
CONTAINS_CODE=False
MD=".md"

for CHANGED_FILE in $CHANGED_FILES; do
  if [[ $CHANGED_FILE =~ $MD ]]; then
    CONTAINS_DOCS=True
  else
    CONTAINS_CODE=True
  fi
done

if [[ $CONTAINS_DOCS == True ]]; then
  echo "Markdown files found. Linting them..."
  # Once the documentation is cleaned up, this should make travis error in case of warnings
  npm install
  .travis/markdown-lint
  if [[ $CONTAINS_CODE == False ]]; then
  echo "Only documentation, terminating build."
    travis_terminate 0
    exit 1
  fi
fi
echo "Continuing build..."
exit 0
