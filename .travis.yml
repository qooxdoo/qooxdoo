sudo: required
dist: trusty
language: php
php:
  - '5.5'
before_script:
  - sudo add-apt-repository "deb http://archive.ubuntu.com/ubuntu/ trusty multiverse"
  - sudo add-apt-repository "deb http://archive.ubuntu.com/ubuntu/ trusty-updates multiverse"
  - sudo apt-get update
  - sudo apt-get install -qq apache2 libapache2-mod-fastcgi
  - sudo cp ~/.phpenv/versions/$(phpenv version-name)/etc/php-fpm.conf.default ~/.phpenv/versions/$(phpenv version-name)/etc/php-fpm.conf
  - sudo a2enmod rewrite actions fastcgi alias
  - echo "cgi.fix_pathinfo = 1" >> ~/.phpenv/versions/$(phpenv version-name)/etc/php.ini
  - ~/.phpenv/versions/$(phpenv version-name)/sbin/php-fpm
  - sudo cp -f tool/test/travis/apache-site.conf /etc/apache2/sites-available/000-default.conf
  - sudo sed -e "s?%TRAVIS_BUILD_DIR%?$(pwd)?g" --in-place /etc/apache2/sites-available/000-default.conf
  - sudo chmod go+rx $(eval echo ~$USER)
  - sudo service apache2 restart
  - wget https://bitbucket.org/ariya/phantomjs/downloads/phantomjs-2.1.1-linux-x86_64.tar.bz2
  - tar xvfj phantomjs-2.1.1-linux-x86_64.tar.bz2 --wildcards */bin/phantomjs
  - sudo mv */bin/phantomjs /usr/bin
  - tool/test/travis/setup
script: tool/test/travis/run http://localhost/framework/test-console/index-source.html
