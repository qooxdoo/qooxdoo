<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>qooxdoo &raquo; Demo Browser</title>

  <script type="text/javascript">
    qxsettings = {
      "qx.application":"BasicSample"
    };
  </script>

  <script type="text/javascript" src="../../script/demo.js"></script>
  <script type="text/javascript" src="../util.js"></script>

	<style type="text/css">
	#keylogger {
		position: absolute;
		width: 500px;
		height: 500px;
		left: 30px;
		top: 40px;
		color: black;
		background-color: #EEE;
		padding: 5px;
		border: 1px inset;
		overflow: scroll;
		/* display:none; */
	}

	table {
		width: 100%;
	}

	td {
		text-align: center;
	}

  #btnClear {
    position: absolute;
    left: 550px;
    top: 40px;
  }

	</style>

</head>
<body>
  <div id="description">
    <p>Keyhandler Test</p>
		<p>Keyhandler test converted to use the low level event API.</p>
  </div>


	<div id="keylogger">
	</div>

  <input type="button" id="btnClear" value="clear">

	<script type="text/javascript">

qx.Class.define("BasicSample",
{
  extend : qx.application.Abstract,

  members :
  {
    main : function()
    {
      this.base(arguments);

      this.tableHead =
        "<table><tr>" +
        "<th>Event</th>" +
        "<th>key identifier</th>" +
        //"<th>key code</th>" +
        //"<th>char code</th>" +
        "<th>Shift</th>" +
        "<th>Ctrl</th>" +
        "<th>Alt</th>" +
        "</tr>";
  		this.keyEvents = [];
  		this.maxLogSize = 50;
  		this.logDiv = document.getElementById("keylogger");

  		this.initializeLogger();

      var events = ["keydown", "keypress", "keyup"];
      for (var i=0; i<events.length; i++)
      {
        qx.event.Registration.addListener(
          document.documentElement,
          events[i],
          this.logKeyEvent,
          this
        )
      }

      qx.event.Registration.addListener(
        document.getElementById("btnClear"),
        "click",
        this.initializeLogger,
        this
      );

    },

    initializeLogger: function()
    {
			this.logDiv.innerHTML = this.tableHead + "</table>";
			this.keyEvents = [];
		},

    logKeyEvent: function(keyEvent)
    {
      var type = keyEvent.getType();
      var eventCopy = {
				type: keyEvent.getType(),
				iden: keyEvent.getKeyIdentifier(),
				//keyCode: keyEvent._keyCode,
				//charCode: type == "keypress" ? "" : keyEvent.getCharCode(),
				shift: keyEvent.isShiftPressed(),
				alt: keyEvent.isAltPressed(),
				ctrl: keyEvent.isCtrlPressed()
			}
			this.keyEvents.unshift(eventCopy);
			this.keyEvents = this.keyEvents.slice(0, this.maxLogSize);
			str = [this.tableHead];
			for (var i=0; i<this.keyEvents.length; i++) {
				var e = this.keyEvents[i];
				str.push("<tr><td>");
				str.push(e.type);
				str.push("</td><td>");
				str.push(e.iden);
				str.push("</td><td>");
				//str.push(e.keyCode);
				//str.push("</td><td>");
				//str.push(e.charCode);
				//str.push("</td><td>");
				str.push(e.shift);
				str.push("</td><td>");
				str.push(e.ctrl);
				str.push("</td><td>");
				str.push(e.alt);
				str.push("</td></tr>");
			}
			str.push("</table>");
			this.logDiv.innerHTML = str.join("");
			this.logDiv.scrollTop = 0;
		}
  }
});

qx.core.Init.getInstance().setApplication(new BasicSample);

		</script>
</body>
</html>
